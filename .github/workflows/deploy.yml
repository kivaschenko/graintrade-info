# name: Deploy to Remote Server

# on:
#   push:
#     branches:
#       - main

# concurrency:
#   group: production_environment
#   cancel-in-progress: true

# jobs:
#   deploy:
#     runs-on: ubuntu-22.04
#     timeout-minutes: 10

#     environment:
#       name: production
#       url: https://graintrade.info

#     env:
#       REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
#       REMOTE_USER: ${{ secrets.REMOTE_USER }}
#       REMOTE_PATH: ${{ secrets.REMOTE_PATH }}

#     steps:
#       - name: Checkout source
#         uses: actions/checkout@v3

#       - name: Setup SSH
#         uses: webfactory/ssh-agent@v0.7.0
#         with:
#           ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

#       - name: Copy project to remote Server
#         run: |
#           rsync -avz --delete \
#             -e "ssh -o StrictHostKeyChecking=no" \
#             --exclude '.git' \
#             --exclude '.github' \
#             --exclude 'node_modules' \
#             --exclude '.env' \
#             --exclude '.env.production' \
#             --exclude '.env.local' \
#             ./ ${REMOTE_USER}@${REMOTE_HOST}:${REMOTE_PATH}/
#         continue-on-error: false

#       - name: Remote build and up
#         uses: appleboy/ssh-action@master
#         with:
#           host: ${{ secrets.REMOTE_HOST }}
#           username: ${{ secrets.REMOTE_USER }}
#           key: ${{ secrets.SSH_PRIVATE_KEY }}
#           script: |
#             cd ${REMOTE_PATH}
#             docker compose down || true
#             docker compose build --no-cache
#             docker compose up -d
