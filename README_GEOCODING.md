# üåæ GrainTrade.info - Free Geocoding Update

## üéâ –©–æ –Ω–æ–≤–æ–≥–æ?

**–†–µ–≤–æ–ª—é—Ü—ñ–π–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è**: –¢–µ–ø–µ—Ä —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤ **–ø–æ–≤–Ω—ñ—Å—Ç—é –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–µ**!

### –ë—É–ª–æ:
- üí∞ Mapbox geocoding: $5 –∑–∞ 1000 —Ç–æ–≤–∞—Ä—ñ–≤
- üêå –ü–æ–≤—ñ–ª—å–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è (–≤–∑–∞—î–º–æ–¥—ñ—è –∑ –∫–∞—Ä—Ç–æ—é)
- üì¶ –û–±–º–µ–∂–µ–Ω–Ω—è: 5-10 —Ç–æ–≤–∞—Ä—ñ–≤ –Ω–∞ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ–º—É —Ç–∞—Ä–∏—Ñ—ñ

### –°—Ç–∞–ª–æ:
- ‚úÖ **–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π** geocoding —á–µ—Ä–µ–∑ Nominatim
- ‚úÖ **–®–≤–∏–¥–∫–µ** —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è (–ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–µ –ø–æ–ª–µ)
- ‚úÖ **–ù–µ–æ–±–º–µ–∂–µ–Ω–∏–π** —ñ–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä—ñ–≤
- ‚úÖ –ú–æ–∂–Ω–∞ –∑–±—ñ–ª—å—à–∏—Ç–∏ –ª—ñ–º—ñ—Ç–∏ —Ç–∞—Ä–∏—Ñ—ñ–≤ –¥–æ 50-100 —Ç–æ–≤–∞—Ä—ñ–≤

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó

```
‚îú‚îÄ‚îÄ CHANGES_SUMMARY.md                    # üìã –ü–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∑–º—ñ–Ω
‚îú‚îÄ‚îÄ FREE_GEOCODING_IMPLEMENTATION.md      # üìñ –¢–µ—Ö–Ω—ñ—á–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ QUICK_START_GEOCODING_UA.md           # üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç (—É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é)
‚îú‚îÄ‚îÄ examples/bulk_import_template.csv     # üìä –®–∞–±–ª–æ–Ω CSV —ñ–º–ø–æ—Ä—Ç—É
‚îú‚îÄ‚îÄ scripts/test_geocoding.py             # üß™ –¢–µ—Å—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç
‚îî‚îÄ‚îÄ frontend/i18n_translations_addon.txt  # üåê –ü–µ—Ä–µ–∫–ª–∞–¥–∏
```

## ‚ö° –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç (5 —Ö–≤–∏–ª–∏–Ω)

### 1. –û–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
```bash
cd backend
poetry add aiohttp
```

### 2. –ú—ñ–≥—Ä–∞—Ü—ñ—è –ë–î
```bash
# –Ø–∫—â–æ –±–∞–∑–∞ —ñ—Å–Ω—É—î
docker exec -it graintrade-postgres psql -U user -d db \
  -f /docker-entrypoint-initdb.d/migration_add_address.sql

# –ê–ë–û –ø–µ—Ä–µ—Å—Ç–≤–æ—Ä–∏—Ç–∏ (–≤–∏–¥–∞–ª–∏—Ç—å –¥–∞–Ω—ñ!)
docker-compose down -v postgres && docker-compose up -d postgres
```

### 3. –û–Ω–æ–≤–∏—Ç–∏ frontend
```bash
cd frontend/src/components
mv ItemForm.vue ItemForm_old.vue
mv ItemForm_new.vue ItemForm.vue
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å–∏
```bash
docker-compose restart backend frontend
```

### 5. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏
```bash
# –¢–µ—Å—Ç geocoding
python scripts/test_geocoding.py

# –ê–±–æ —á–µ—Ä–µ–∑ Docker
docker exec -it graintrade-backend python scripts/test_geocoding.py
```

## üìö –î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

### –î–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤
üëâ [FREE_GEOCODING_IMPLEMENTATION.md](FREE_GEOCODING_IMPLEMENTATION.md) - –ø–æ–≤–Ω–∞ —Ç–µ—Ö–Ω—ñ—á–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

### –î–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Å—Ç–∞—Ä—Ç—É
üëâ [QUICK_START_GEOCODING_UA.md](QUICK_START_GEOCODING_UA.md) - –ø–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é

### –°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –∑–º—ñ–Ω
üëâ [CHANGES_SUMMARY.md](CHANGES_SUMMARY.md) - –¥–µ—Ç–∞–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∑–º—ñ–Ω —É –∫–æ–∂–Ω–æ–º—É —Ñ–∞–π–ª—ñ

## üîß –û—Å–Ω–æ–≤–Ω—ñ –∑–º—ñ–Ω–∏

### Backend
1. –ù–æ–≤–∏–π —Å–µ—Ä–≤—ñ—Å: `geocoding_service.py` (Nominatim API)
2. –û–Ω–æ–≤–ª–µ–Ω–æ: `schemas.py`, `items_model.py`, `item_routers.py`
3. –î–æ–¥–∞–Ω–æ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å: `aiohttp`

### Database
1. –ù–æ–≤–µ –ø–æ–ª–µ: `address VARCHAR(300)`
2. Nullable –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: `latitude`, `longitude`
3. –ú—ñ–≥—Ä–∞—Ü—ñ–π–Ω–∏–π —Å–∫—Ä–∏–ø—Ç: `migration_add_address.sql`

### Frontend
1. –ù–æ–≤–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: `ItemForm_new.vue`
2. –¢–µ–∫—Å—Ç–æ–≤–µ –ø–æ–ª–µ –∑–∞–º—ñ—Å—Ç—å —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—ó –∫–∞—Ä—Ç–∏
3. –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –Ω–∞ —Å—Ç–∞—Ç–∏—á–Ω—ñ–π –∫–∞—Ä—Ç—ñ

## üí° –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É —á–µ—Ä–µ–∑ UI
```
1. –û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é: "Wheat"
2. –í–≤–µ–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É: "Kyiv, Ukraine"
3. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ü—ñ–Ω—É, –∫—ñ–ª—å–∫—ñ—Å—Ç—å
4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "Create"

‚Üí –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤–∏–∑–Ω–∞—á–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ! ‚úÖ
```

### –ú–∞—Å–æ–≤–∏–π —ñ–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ CSV
```csv
category_id,offer_type,title,price,currency,amount,measure,terms_delivery,address,country
1,sell,Sell Wheat,250,USD,1000,metric ton,FOB,Kyiv,Ukraine
2,sell,Sell Corn,180,USD,500,metric ton,DAP,Odesa,Ukraine
```

### API –∑–∞–ø–∏—Ç
```javascript
POST /items
{
  "category_id": 1,
  "offer_type": "sell",
  "title": "Sell Wheat",
  "price": 250,
  "currency": "USD",
  "amount": 1000,
  "measure": "metric ton",
  "terms_delivery": "FOB",
  "address": "Kyiv, Ukraine",  // –ù–æ–≤–µ –ø–æ–ª–µ!
  "country": "Ukraine"
  // latitude, longitude - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
}
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç geocoding —Å–µ—Ä–≤—ñ—Å—É
```bash
python scripts/test_geocoding.py
```

–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚úÖ Testing: 'Kyiv, Ukraine'
   Latitude:  50.4501
   Longitude: 30.5234
   Country:   Ukraine
   Region:    Kyiv City
```

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ API
```bash
curl -X POST http://localhost:8000/items \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "category_id": 1,
    "address": "Kyiv, Ukraine",
    ...
  }'
```

## üìä –ï–∫–æ–Ω–æ–º—ñ—è –∫–æ—à—Ç—ñ–≤

| –°—Ü–µ–Ω–∞—Ä—ñ–π | –î–æ | –ü—ñ—Å–ª—è | –ï–∫–æ–Ω–æ–º—ñ—è |
|----------|-----|-------|----------|
| 1000 —Ç–æ–≤–∞—Ä—ñ–≤/–º—ñ—Å | $5 | $0 | **$60/—Ä—ñ–∫** |
| 10000 —Ç–æ–≤–∞—Ä—ñ–≤/–º—ñ—Å | $50 | $0 | **$600/—Ä—ñ–∫** |
| CSV —ñ–º–ø–æ—Ä—Ç 5000 | $25 | $0 | **$25** |

## ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏

1. **–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ**: Nominatim API –ø–æ–≤–Ω—ñ—Å—Ç—é –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π
2. **–®–≤–∏–¥–∫–æ**: –¢–µ–∫—Å—Ç–æ–≤–µ –ø–æ–ª–µ —à–≤–∏–¥—à–µ –∑–∞ –∫–∞—Ä—Ç—É
3. **–ó—Ä—É—á–Ω–æ**: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –≤–≤–æ–¥—è—Ç—å –∑–Ω–∞–π–æ–º—ñ –∞–¥—Ä–µ—Å–∏
4. **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–æ**: –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ CSV —ñ–º–ø–æ—Ä—Ç—É
5. **–ù–∞–¥—ñ–π–Ω–æ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ fallback —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó
6. **–°—É–º—ñ—Å–Ω–æ**: –°—Ç–∞—Ä–∏–π API –≤—Å–µ —â–µ –ø—Ä–∞—Ü—é—î

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

### Nominatim Usage Policy
- –ú–∞–∫—Å–∏–º—É–º 1 –∑–∞–ø–∏—Ç/—Å–µ–∫—É–Ω–¥—É ‚úÖ (–≤—Ä–∞—Ö–æ–≤–∞–Ω–æ –≤ –∫–æ–¥—ñ)
- User-Agent –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π ‚úÖ (–Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ)
- –î–ª—è –≤–∏—Å–æ–∫–∏—Ö –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å —Ä–æ–∑–≥–ª—è–Ω—É—Ç–∏ self-hosting

### –§–æ—Ä–º–∞—Ç–∏ –∞–¥—Ä–µ—Å
```
‚úÖ –ü—Ä–∞—Ü—é—î:
- "Kyiv"
- "–ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞"
- "Odesa, Ukraine"
- "–≤—É–ª–∏—Ü—è –•—Ä–µ—â–∞—Ç–∏–∫, –ö–∏—ó–≤"

‚ùå –ù–µ –ø—Ä–∞—Ü—é—î:
- –î—É–∂–µ –∑–∞–≥–∞–ª—å–Ω—ñ ("Europe")
- –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ ("asdfgh")
```

## üêõ Troubleshooting

### Geocoding –Ω–µ –ø—Ä–∞—Ü—é—î?
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏
docker-compose logs -f backend | grep geocoding

# –¢–µ—Å—Ç –≤—Ä—É—á–Ω—É
python scripts/test_geocoding.py
```

### –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ?
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∞–¥—Ä–µ—Å–∏
- –°–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ—Å—Ç—ñ—à–∏–π —Ñ–æ—Ä–º–∞—Ç ("Kyiv" –∑–∞–º—ñ—Å—Ç—å –ø–æ–≤–Ω–æ—ó –∞–¥—Ä–µ—Å–∏)
- –¢–æ–≤–∞—Ä –≤—Å–µ –æ–¥–Ω–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è, –ø—Ä–æ—Å—Ç–æ –±–µ–∑ –∫–∞—Ä—Ç–∏

### –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –Ω–µ –æ–Ω–æ–≤–∏–ª–∞—Å—è?
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø–æ–ª—è
docker exec -it graintrade-postgres psql -U user -d db \
  -c "SELECT column_name FROM information_schema.columns WHERE table_name='items';"

# –Ø–∫—â–æ –Ω–µ–º–∞—î 'address' - –≤–∏–∫–æ–Ω–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é
docker exec -it graintrade-postgres psql -U user -d db \
  -f /docker-entrypoint-initdb.d/migration_add_address.sql
```

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

### –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –∑–∞—Ä–∞–∑:
1. ‚úÖ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ staging
2. ‚úÖ –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤
3. ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

### –ú–æ–∂–ª–∏–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:
1. –ö–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ geocoding
2. –ê–≤—Ç–æ–∫–æ–º–ø–ª—ñ—Ç –∞–¥—Ä–µ—Å –Ω–∞ frontend
3. Self-hosted Nominatim –¥–ª—è –ø–æ–≤–Ω–æ—ó –Ω–µ–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
4. Google Geocoding —è–∫ fallback
5. Batch geocoding –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:**
- –¢–µ—Ö–Ω—ñ—á–Ω–∞: [FREE_GEOCODING_IMPLEMENTATION.md](FREE_GEOCODING_IMPLEMENTATION.md)
- –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç: [QUICK_START_GEOCODING_UA.md](QUICK_START_GEOCODING_UA.md)
- –ó–º—ñ–Ω–∏: [CHANGES_SUMMARY.md](CHANGES_SUMMARY.md)

**–ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
```bash
# –õ–æ–≥–∏
docker-compose logs -f backend | grep geocoding

# –°—Ç–∞–Ω –ë–î
docker exec -it graintrade-postgres psql -U user -d db \
  -c "SELECT id, address, latitude, longitude FROM items LIMIT 5;"

# –¢–µ—Å—Ç
python scripts/test_geocoding.py
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ:
- ‚úÖ –°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ **–Ω–µ–æ–±–º–µ–∂–µ–Ω—É** –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ
- ‚úÖ –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä–∏ –∑ CSV **–±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –≤–∏—Ç—Ä–∞—Ç**
- ‚úÖ **–ó–±—ñ–ª—å—à–∏—Ç–∏ –ª—ñ–º—ñ—Ç–∏** —Ç–∞—Ä–∏—Ñ–Ω–∏—Ö –ø–ª–∞–Ω—ñ–≤ —É 5-10 —Ä–∞–∑—ñ–≤
- ‚úÖ **–ü–æ–∫—Ä–∞—â–∏—Ç–∏ UX** –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- ‚úÖ **–ó–∞–æ—â–∞–¥–∏—Ç–∏** $60-600/—Ä—ñ–∫ –Ω–∞ geocoding

---

## üèÜ –ö—Ä–µ–¥–∏—Ç–∏

- **Geocoding**: [Nominatim](https://nominatim.org/) (OpenStreetMap)
- **Maps**: [Mapbox](https://www.mapbox.com/) (—Ç—ñ–ª—å–∫–∏ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è)
- **Rate Limiting**: –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∑–≥—ñ–¥–Ω–æ –∑ [Nominatim Usage Policy](https://operations.osmfoundation.org/policies/nominatim/)

---

**–ü–∏—Ç–∞–Ω–Ω—è?** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é –∞–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å issue.

**–ì–æ—Ç–æ–≤—ñ —Ä–æ–∑–≥–æ—Ä—Ç–∞—Ç–∏?** –ü–æ—á–Ω—ñ—Ç—å –∑ [QUICK_START_GEOCODING_UA.md](QUICK_START_GEOCODING_UA.md)! üöÄ
