<IfModule mod_ssl.c>
# Redirect HTTP to HTTPS
<VirtualHost *:80>
    ServerName graintrade.info
    ServerAlias www.graintrade.info
    Redirect permanent / https://graintrade.info
    RewriteEngine on
    RewriteCond %{SERVER_NAME} =api.graintrade.info
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<VirtualHost *:443>
    ServerAdmin webmaster@localhost

    # You will no longer need DocumentRoot or the Directory block.
    # We are replacing them with ProxyPass directives.
    # DocumentRoot /var/www/graintrade.info
    # <Directory /var/www/graintrade.info>
    #     Options Indexes FollowSymLinks
    #     AllowOverride All
    #     Require all granted
    # </Directory>
    # <Directory /var/www/graintrade.info>
    #     RewriteEngine On
    #     RewriteBase /
    #     RewriteRule ^index\.html$ - [L]
    #     RewriteCond %{REQUEST_FILENAME} !-f
    #     RewriteCond %{REQUEST_FILENAME} !-d
    #     RewriteRule . /index.html [L]
    # </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    ServerName graintrade.info
    ServerAlias www.graintrade.info

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/graintrade.info/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/graintrade.info/privkey.pem

    # The crucial part: Proxying all requests to the frontend container
    ProxyPreserveHost On
    ProxyPass / http://localhost:8080/
    ProxyPassReverse / http://localhost:8080/

</VirtualHost>
</IfModule>
