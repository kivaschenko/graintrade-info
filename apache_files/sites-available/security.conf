# Apache Security Configuration for Graintrade API
# This file contains additional security configurations

# Enable mod_evasive for better rate limiting (install with: sudo apt-get install libapache2-mod-evasive)
<IfModule mod_evasive24.c>
    DOSHashTableSize    2048
    DOSPageCount        2
    DOSPageInterval     1
    DOSSiteCount        50
    DOSSiteInterval     1
    DOSBlockingPeriod   600
    DOSLogDir           /var/log/apache2/evasive
    DOSEmailNotify      admin@graintrade.info
    DOSWhitelist        127.0.0.1
    DOSWhitelist        172.18.0.*
</IfModule>

# Alternative: mod_security rules (install with: sudo apt-get install libapache2-mod-security2)
<IfModule mod_security2.c>
    # Basic ModSecurity configuration
    SecRuleEngine On
    SecRequestBodyAccess On
    SecResponseBodyAccess Off
    SecRequestBodyLimit 13107200
    SecRequestBodyNoFilesLimit 131072
    SecRequestBodyInMemoryLimit 131072
    SecRequestBodyLimitAction Reject
    SecPcreMatchLimit 1000
    SecPcreMatchLimitRecursion 1000
    
    # Block common attack patterns
    SecRule REQUEST_URI "@detectSQLi" \
        "id:1001,phase:1,block,msg:'SQL Injection Attack Detected',logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}'"
    
    SecRule REQUEST_URI "@detectXSS" \
        "id:1002,phase:1,block,msg:'XSS Attack Detected',logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}'"
</IfModule>

# IP-based blocking (add suspicious IPs here)
<RequireAll>
    Require all granted
    Require not ip 147.185.132.183
    # Add more suspicious IPs as needed
</RequireAll>